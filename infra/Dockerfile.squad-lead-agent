FROM python:3.12-slim-bookworm


# 1. Install uv (Copy binary from official image - safest & fastest method)
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

# 2. Set working directory
WORKDIR /app

# Install curl for healthcheck
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# 3. Copy dependency files first (for caching)
COPY Shinox/agents/squad_lead/pyproject.toml Shinox/agents/squad_lead/uv.lock ./

# 4. Install dependencies only (better layer caching)
RUN uv sync --no-dev --no-install-project

# 5. Copy all application code (preserving structure)
COPY Shinox/agents/squad_lead/ ./

# 6. Install the project itself
RUN uv sync --no-dev

# Use the virtual environment automatically
ENV PATH="/app/.venv/bin:$PATH"

# Run the A2A agent server
CMD ["faststream", "run", "main:app"]
